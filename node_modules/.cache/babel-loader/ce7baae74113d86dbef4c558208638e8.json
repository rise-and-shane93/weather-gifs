{"ast":null,"code":"import _objectSpread from\"/home/rise-and-shane93/Desktop/devProjects/react/weather-gif/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/rise-and-shane93/Desktop/devProjects/react/weather-gif/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/rise-and-shane93/Desktop/devProjects/react/weather-gif/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/rise-and-shane93/Desktop/devProjects/react/weather-gif/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/rise-and-shane93/Desktop/devProjects/react/weather-gif/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/rise-and-shane93/Desktop/devProjects/react/weather-gif/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import{connect}from\"react-redux\";import{logoutUser}from\"../../redux/actions/authActions\";import{handleAddToUserData,getWeather,changeTemp}from\"../../redux/actions/weather\";import SearchResults from'./SearchResults';import UserSelectedData from'./UserSelectedData';import UserSelectedCity from'./UserSelectedCity';var Dashboard=/*#__PURE__*/function(_Component){_inherits(Dashboard,_Component);function Dashboard(props){var _this;_classCallCheck(this,Dashboard);_this=_possibleConstructorReturn(this,_getPrototypeOf(Dashboard).call(this,props));_this.viewCity=function(e){if(e.target.textContent!==\"Ã—\"){var userSelectedCity=e.target.closest(\".user-selected-child\").querySelector(\"h6\").textContent;var cityObject=_this.props.storedWeatherData.filter(function(el,i){return el.location===userSelectedCity;});_this.setState({selectCity:cityObject[0]});_this.selectedCityData.current.style.display=\"flex\";}};_this.dataLimitFalse=function(){_this.setState({dataLimit:false});};_this.handleTemp=function(e){var type=e.target.value;_this.props.changeTemp(\"/api/weather/\".concat(_this.state.urlUserName,\"/\").concat(type));window.location.reload();};_this.selectCity=function(e){e.preventDefault();if(_this.props.storedWeatherData.length===5){_this.setState({dataLimit:true});}var query=encodeURIComponent(e.target.search.value);var weatherData={lat:\"\",lng:\"\",location:\"\",desc:\"\",currTempF:\"\",minTempF:\"\",maxTempF:\"\",currTempC:\"\",minTempC:\"\",maxTempC:\"\",humidity:\"\",windSpeedM:\"\",windSpeedK:\"\",windDirDeg:\"\",index:\"\",icon:\"\"// windGust: \"\"\n};weatherData.location=e.target.search.value.split(',')[0];_this.props.storedWeatherData.forEach(function(el,i){if(weatherData.location===el.location){_this.setState({duplicateSearch:true});}});fetch(\"https://maps.googleapis.com/maps/api/geocode/json?&address=\".concat(query,\"&key=AIzaSyDnNkqJyGkWjJcQxN2dGcZr5KHnw1mlB7A\")).then(function(res){return res.json();}).then(function(res){weatherData.lat=res.results[0].geometry.bounds.northeast.lat;weatherData.lng=res.results[0].geometry.bounds.northeast.lng;return fetch(\"https://api.openweathermap.org/data/2.5/weather?lat=\".concat(weatherData.lat,\"&lon=\").concat(weatherData.lng,\"&appid=7ce1fd394a7aaa5d61d9b5930c1b3513&units=imperial\"));}).then(function(res){return res.json();}).then(function(res){var weather=res.weather,main=res.main,wind=res.wind;// weatherData.location = res.name;\nweatherData.desc=weather[0].main;weatherData.currTempF=Math.round(main.temp);weatherData.minTempF=Math.round(main.temp_min);weatherData.maxTempF=Math.round(main.temp_max);weatherData.currTempC=Math.round((weatherData.currTempF-32)/1.8);weatherData.minTempC=Math.round((weatherData.minTempF-32)/1.8);weatherData.maxTempC=Math.round((weatherData.maxTempF-32)/1.8);weatherData.humidity=Math.round(main.humidity);weatherData.windSpeedM=Math.round(wind.speed);weatherData.windSpeedK=Math.round(wind.speed*1.609344);weatherData.windDir=Math.round(wind.deg);weatherData.index=_this.props.storedWeatherData.length;weatherData.icon=weather[0].icon;// weatherData.windGust = Math.round(wind.gust);\n}).then(function(){_this.setState(_objectSpread({},_this.state,{weatherData:_objectSpread({},weatherData)}));})// .then(()=> {\n//   this.renderedWeatherData.current.innerHTML = <SearchResults weatherData={this.state.weatherData}/>;\n// })\n.then(function(){_this.renderedWeatherData.current.style.display=\"flex\";}).catch(function(err){return console.log(\"Something wrong happened: \".concat(err));}).finally(console.log('weather search finished'));e.target.search.value=\"\";};_this.renderWeatherData=function(data){return React.createElement(SearchResults,{weatherData:data});};_this.handleDelete=function(type){if(type===\"search\"){_this.setState({weatherData:undefined});if(_this.state.duplicateSearch){_this.setState({duplicateSearch:false});}_this.renderedWeatherData.current.style.display=\"none\";}else if(type===\"select\"){_this.setState({selectCity:{}});_this.selectedCityData.current.style.display=\"none\";}};_this.addToDB=function(){console.log('add to db');var _this$state=_this.state,urlUserName=_this$state.urlUserName,weatherData=_this$state.weatherData;_this.props.handleAddToUserData(\"/api/weather/\".concat(urlUserName),weatherData);_this.handleDelete(\"search\");};_this.onLogoutClick=function(e){e.preventDefault();_this.props.logoutUser();};_this.renderedWeatherData=React.createRef();_this.selectedCityData=React.createRef();//local state will only be used for when a user is adding a city.\n_this.state={duplicateSearch:false,dataLimit:false,selectCity:{}// weatherData: {\n// lat: undefined,\n// lng: undefined,\n// location: undefined,\n// desc: undefined,\n// currTemp: undefined,\n// minTemp: undefined,\n// maxTemp: undefined,\n// humidity: undefined,\n// windSpeed: undefined,\n// windDir: undefined,\n// windGust: undefined\n// }\n};return _this;}_createClass(Dashboard,[{key:\"componentDidUpdate\",value:function componentDidUpdate(){this.renderWeatherData(this.state.weatherData);}},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;console.log(this.props.tempValue);var url=window.location.pathname.split('/');var urlUserName=url[url.length-1];this.setState(_objectSpread({urlUserName:urlUserName},this.state),function(){_this2.props.getWeather(\"/api/weather/\".concat(urlUserName));});}},{key:\"render\",value:function render(){var _this3=this;var user=this.props.auth.user;var _this$props=this.props,storedWeatherData=_this$props.storedWeatherData,tempValue=_this$props.tempValue;var urlUserName=this.state.urlUserName;return React.createElement(\"div\",{className:\"container valign-wrapper\"},React.createElement(\"div\",{className:\"row\"},React.createElement(\"div\",{className:\"col s12 center-align\"},React.createElement(\"h4\",null,React.createElement(\"b\",null,\"Hey there,\"),\" \",user.name.split(\" \")[0],React.createElement(\"p\",{className:\"flow-text grey-text text-darken-1\"},\"Welcome to Weather in .GIFS! Find your city to get started.\",React.createElement(\"br\",null),\"Then, click on a city you selected to view the .gif!\")),React.createElement(\"form\",{onSubmit:this.selectCity},React.createElement(\"label\",{htmlFor:\"search\"},\"Search by city:\"),React.createElement(\"div\",{className:\"flexRow\"},React.createElement(\"input\",{type:\"text\",name:\"search\",placeholder:\"Ex: Atlanta, GA\"}),React.createElement(\"button\",{onClick:this.locateCity,className:\"btn waves-effect waves-light hoverable blue accent-3\"},\"Search!\"))),React.createElement(\"div\",{className:\"selectedCityData\",ref:this.selectedCityData,style:{'display':'none'}},Object.keys(this.state.selectCity).length===0?false:React.createElement(UserSelectedCity,{data:this.state.selectCity,handleDelete:this.handleDelete})),React.createElement(\"div\",{className:\"renderedWeatherData\",ref:this.renderedWeatherData,style:{'display':'none'}},!!this.state.weatherData?React.createElement(SearchResults,{weatherData:this.state.weatherData,handleDelete:this.handleDelete,addToDB:this.addToDB,dataLength:this.props.storedWeatherData,duplicateSearch:this.state.duplicateSearch,dataLimit:this.state.dataLimit}):false),React.createElement(\"div\",{className:\"user-selcted-weather\",onClick:this.viewCity},storedWeatherData.map(function(el,i){return React.createElement(UserSelectedData,{key:i,data:el,urlUserName:urlUserName,index:el.index,location:el.location,icon:el.icon,dataLimitFalse:_this3.dataLimitFalse});})),React.createElement(\"button\",{style:{width:\"150px\",borderRadius:\"3px\",letterSpacing:\"1.5px\",marginTop:\"1rem\"},onClick:this.onLogoutClick,className:\"btn btn-large waves-effect waves-light hoverable blue accent-3\"},\"Logout\"),React.createElement(\"div\",null,React.createElement(\"label\",{className:\"selectLabel\",htmlFor:\"selectTemp\"},\"C\\xB0 / F\\xB0\"),React.createElement(\"select\",{name:\"selectTemp\",value:tempValue,onChange:this.handleTemp},React.createElement(\"option\",{value:\"F\"},\"F\\xB0\"),React.createElement(\"option\",{value:\"C\"},\"C\\xB0\"))))));}}]);return Dashboard;}(Component);var mapStateToProps=function mapStateToProps(state){return{auth:state.auth,storedWeatherData:state.weather.weatherData,tempValue:state.weather.temperature};};export default connect(mapStateToProps,{logoutUser:logoutUser,handleAddToUserData:handleAddToUserData,getWeather:getWeather,changeTemp:changeTemp})(Dashboard);","map":{"version":3,"sources":["/home/rise-and-shane93/Desktop/devProjects/react/weather-gif/src/components/dashboard/Dashboard.js"],"names":["React","Component","connect","logoutUser","handleAddToUserData","getWeather","changeTemp","SearchResults","UserSelectedData","UserSelectedCity","Dashboard","props","viewCity","e","target","textContent","userSelectedCity","closest","querySelector","cityObject","storedWeatherData","filter","el","i","location","setState","selectCity","selectedCityData","current","style","display","dataLimitFalse","dataLimit","handleTemp","type","value","state","urlUserName","window","reload","preventDefault","length","query","encodeURIComponent","search","weatherData","lat","lng","desc","currTempF","minTempF","maxTempF","currTempC","minTempC","maxTempC","humidity","windSpeedM","windSpeedK","windDirDeg","index","icon","split","forEach","duplicateSearch","fetch","then","res","json","results","geometry","bounds","northeast","weather","main","wind","Math","round","temp","temp_min","temp_max","speed","windDir","deg","renderedWeatherData","catch","err","console","log","finally","renderWeatherData","data","handleDelete","undefined","addToDB","onLogoutClick","createRef","tempValue","url","pathname","user","auth","name","locateCity","Object","keys","map","width","borderRadius","letterSpacing","marginTop","mapStateToProps","temperature"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { connect } from \"react-redux\";\nimport { logoutUser } from \"../../redux/actions/authActions\";\nimport { handleAddToUserData, getWeather, changeTemp } from \"../../redux/actions/weather\";\n\nimport SearchResults from './SearchResults';\nimport UserSelectedData from './UserSelectedData';\nimport UserSelectedCity from './UserSelectedCity';\n\nclass Dashboard extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.renderedWeatherData = React.createRef();\n    this.selectedCityData = React.createRef();\n\n    //local state will only be used for when a user is adding a city.\n    this.state = {\n      duplicateSearch: false,\n      dataLimit: false,\n      selectCity: {},\n      // weatherData: {\n        // lat: undefined,\n        // lng: undefined,\n        // location: undefined,\n        // desc: undefined,\n        // currTemp: undefined,\n        // minTemp: undefined,\n        // maxTemp: undefined,\n        // humidity: undefined,\n        // windSpeed: undefined,\n        // windDir: undefined,\n        // windGust: undefined\n      // }\n    };\n  }\n\n  componentDidUpdate() {\n    this.renderWeatherData(this.state.weatherData);\n  }\n\n  componentDidMount() {\n    console.log(this.props.tempValue);\n    const url = window.location.pathname.split('/');\n    const urlUserName = url[url.length-1];\n    this.setState({\n      urlUserName,\n      ...this.state\n    }, () => {\n      this.props.getWeather(`/api/weather/${urlUserName}`);\n    });\n  }\n\n  viewCity = e => {\n    if(e.target.textContent !== \"Ã—\") {\n      const userSelectedCity = e.target.closest(\".user-selected-child\").querySelector(\"h6\").textContent;\n      const cityObject = this.props.storedWeatherData.filter((el, i) => el.location === userSelectedCity);\n      this.setState({selectCity: cityObject[0]});\n      this.selectedCityData.current.style.display = \"flex\";  \n    }\n  }\n\n  dataLimitFalse = () => {\n    this.setState({dataLimit: false});\n  }\n\n  handleTemp = (e) => {\n    let type = e.target.value;\n    this.props.changeTemp(`/api/weather/${this.state.urlUserName}/${type}`);\n    window.location.reload();\n  }\n\n  selectCity = e => {\n    e.preventDefault();\n    if (this.props.storedWeatherData.length === 5) {\n      this.setState({dataLimit: true});\n    }\n    let query = encodeURIComponent(e.target.search.value);\n    let weatherData = {\n      lat: \"\",\n      lng: \"\",\n      location: \"\",\n      desc: \"\",\n      currTempF: \"\",\n      minTempF: \"\",\n      maxTempF: \"\",\n      currTempC: \"\",\n      minTempC: \"\",\n      maxTempC: \"\",\n      humidity: \"\",\n      windSpeedM: \"\",\n      windSpeedK: \"\",\n      windDirDeg: \"\",\n      index: \"\",\n      icon: \"\"\n      // windGust: \"\"\n    };\n    weatherData.location = e.target.search.value.split(',')[0];\n    this.props.storedWeatherData.forEach((el,i) => {\n      if (weatherData.location === el.location) {\n        this.setState({duplicateSearch: true});\n      }\n    });\n    fetch(`https://maps.googleapis.com/maps/api/geocode/json?&address=${query}&key=AIzaSyDnNkqJyGkWjJcQxN2dGcZr5KHnw1mlB7A`)\n      .then(res => res.json())\n      .then(res => {\n        weatherData.lat = res.results[0].geometry.bounds.northeast.lat;\n        weatherData.lng = res.results[0].geometry.bounds.northeast.lng;\n        return fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${weatherData.lat}&lon=${weatherData.lng}&appid=7ce1fd394a7aaa5d61d9b5930c1b3513&units=imperial`)\n      })\n      .then(res => res.json())\n      .then(res => {\n        const { weather, main, wind } = res;\n        // weatherData.location = res.name;\n        weatherData.desc = weather[0].main;\n        weatherData.currTempF = Math.round(main.temp);\n        weatherData.minTempF = Math.round(main.temp_min);\n        weatherData.maxTempF = Math.round(main.temp_max);\n        weatherData.currTempC = Math.round((weatherData.currTempF - 32) / 1.8);\n        weatherData.minTempC = Math.round((weatherData.minTempF - 32) / 1.8);\n        weatherData.maxTempC = Math.round((weatherData.maxTempF - 32) / 1.8);\n        weatherData.humidity = Math.round(main.humidity);\n        weatherData.windSpeedM = Math.round(wind.speed);\n        weatherData.windSpeedK = Math.round(wind.speed * 1.609344);\n        weatherData.windDir = Math.round(wind.deg);\n        weatherData.index = this.props.storedWeatherData.length;\n        weatherData.icon = weather[0].icon;\n        // weatherData.windGust = Math.round(wind.gust);\n      })\n      .then(() => {\n        this.setState({\n          ...this.state,\n          weatherData: {\n            ...weatherData\n          }\n        });\n      })\n      // .then(()=> {\n      //   this.renderedWeatherData.current.innerHTML = <SearchResults weatherData={this.state.weatherData}/>;\n      // })\n      .then(() => {\n        this.renderedWeatherData.current.style.display = \"flex\";\n      })\n      .catch(err => console.log(`Something wrong happened: ${err}`))\n      .finally(console.log('weather search finished'));\n      e.target.search.value = \"\";\n  }\n\n  renderWeatherData = data => {\n    return <SearchResults weatherData={data}/>\n  }\n\n  handleDelete = (type) => {\n    if (type === \"search\") {\n      this.setState({\n        weatherData: undefined\n      });\n      if (this.state.duplicateSearch) {\n        this.setState({duplicateSearch: false});\n      }\n      this.renderedWeatherData.current.style.display=\"none\";  \n    } else if (type === \"select\") {\n      this.setState({selectCity: {}});\n      this.selectedCityData.current.style.display=\"none\";  \n    }\n  }\n\n  addToDB = () => {\n    console.log('add to db');\n    const { urlUserName, weatherData } = this.state;\n    this.props.handleAddToUserData(`/api/weather/${urlUserName}`, weatherData);\n    this.handleDelete(\"search\");\n  }\n\n  onLogoutClick = e => {\n    e.preventDefault();\n    this.props.logoutUser();\n  };\n\nrender() {\n    const { user } = this.props.auth;\n    const { storedWeatherData, tempValue } = this.props;\n    const { urlUserName } = this.state;\n    return (\n      <div className=\"container valign-wrapper\">\n        <div className=\"row\">\n          <div className=\"col s12 center-align\">\n            <h4>\n              <b>Hey there,</b> {user.name.split(\" \")[0]}\n              <p className=\"flow-text grey-text text-darken-1\">\n                Welcome to Weather in .GIFS! Find your city to get started.<br/>\n                Then, click on a city you selected to view the .gif!\n              </p>\n            </h4>\n            <form onSubmit={this.selectCity}>\n              <label htmlFor=\"search\">Search by city:</label>\n              <div className=\"flexRow\">\n                <input type=\"text\" name=\"search\" placeholder=\"Ex: Atlanta, GA\"/>\n                <button onClick={this.locateCity} className=\"btn waves-effect waves-light hoverable blue accent-3\">\n                  Search!\n                </button>\n              </div>\n            </form>\n            <div className=\"selectedCityData\" ref={this.selectedCityData} style={{'display': 'none'}}>\n              {Object.keys(this.state.selectCity).length === 0 ? false : <UserSelectedCity data={this.state.selectCity} handleDelete={this.handleDelete}/>}\n              {/* {this.state.selectCity ? <UserSelectedCity data={this.state.selectCity}/> : false} */}\n            </div>\n            <div className=\"renderedWeatherData\" ref={this.renderedWeatherData} style={{'display': 'none'}}>\n              {!!this.state.weatherData ? <SearchResults \n              weatherData={this.state.weatherData} \n              handleDelete={this.handleDelete}\n              addToDB={this.addToDB}\n              dataLength={this.props.storedWeatherData}\n              duplicateSearch={this.state.duplicateSearch}\n              dataLimit={this.state.dataLimit}/> : false}\n            </div>\n            <div className=\"user-selcted-weather\" onClick={this.viewCity}>\n              {storedWeatherData.map((el, i) => {\n                return <UserSelectedData \n                          key={i} \n                          data={el} \n                          urlUserName={urlUserName} \n                          index={el.index} \n                          location={el.location}\n                          icon={el.icon}\n                          dataLimitFalse={this.dataLimitFalse}/>\n              })}\n            </div>\n            <button\n              style={{\n                width: \"150px\",\n                borderRadius: \"3px\",\n                letterSpacing: \"1.5px\",\n                marginTop: \"1rem\"\n              }}\n              onClick={this.onLogoutClick}\n              className=\"btn btn-large waves-effect waves-light hoverable blue accent-3\"\n            >\n              Logout\n            </button>\n            <div>\n            <label className=\"selectLabel\" htmlFor=\"selectTemp\">C&deg; / F&deg;</label>\n            <select name=\"selectTemp\" value={tempValue} onChange={this.handleTemp}>\n              <option value=\"F\">F&deg;</option>\n              <option value=\"C\">C&deg;</option>\n            </select>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nDashboard.propTypes = {\n  logoutUser: PropTypes.func.isRequired,\n  auth: PropTypes.object.isRequired\n};\n\nconst mapStateToProps = state => ({\n  auth: state.auth,\n  storedWeatherData: state.weather.weatherData,\n  tempValue: state.weather.temperature\n});\n\nexport default connect(\n  mapStateToProps,\n  { \n    logoutUser,\n    handleAddToUserData,\n    getWeather,\n    changeTemp\n  }\n)(Dashboard);"]},"metadata":{},"sourceType":"module"}